<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="/frontend/cpanel-main.css">
    </head>
    <body class="light">
        <div id="app"></div>
        <script src="/frontend/vendor.bundle.min.js"></script>
        <script type="module">
            /*
             * Store globals
             */
            window.$el = preact.createElement;
            window.myRedirect = (to, full) => {
                if (!full) {
                    window.parent.location.hash = '#' + to;
                } else {
                    window.parent.location.href = window.parent.location.origin + to;
                }
            };
            window.toast = (message, level) => {
                if (level === 'error') console.error(message);
                else console.info(message);
            };
            /*
             * Require all components
             */
            import {InsaneControlPanel} from './app.js';
            /*
             * main()
             */
            preact.render($el(InsaneControlPanel, {
                currentPageData: window.parent.getCurrentPageData()
            }, null), document.getElementById("app"));
            //
            var parentUrlPcs = window.parent.location.href.split('#');
            if (parentUrlPcs[0].indexOf('?rescan=1') > -1) {
                window.parent.history.replaceState(null, window.parent.document.title,
                    window.parent.location.href.replace('?rescan=1', ''));
            } else if (parentUrlPcs[1]) {
                window.location.hash = parentUrlPcs[1];
            }
            //
            window.parent.addEventListener('hashchange', e => {
                if (e.newURL !== e.oldURL) window.location.replace(
                    window.location.href.split('#')[0] + (window.parent.location.hash || '#/')
                );
            });
        </script>
    </body>
</html>